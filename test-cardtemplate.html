<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardTemplate Test - Matching cardtemplate.jpg</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #0f3460;
        }
        .canvas-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        .canvas-wrapper {
            text-align: center;
        }
        canvas {
            border: 2px solid #4facfe;
            border-radius: 8px;
            background: #000;
        }
        button {
            background: #4facfe;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: #357abd;
        }
        .reference-image {
            max-width: 300px;
            border: 2px solid #ffd700;
            border-radius: 8px;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            border-radius: 5px;
            margin-top: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success { background: #2d5a2d; border: 1px solid #4a8f4a; }
        .status.error { background: #5a2d2d; border: 1px solid #8f4a4a; }
        .status.info { background: #2d4a5a; border: 1px solid #4a7a8f; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ CardTemplate Test - Matching cardtemplate.jpg</h1>
        
        <div class="test-section">
            <h2>Reference vs Generated Comparison</h2>
            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <h3>Reference Image (cardtemplate.jpg)</h3>
                    <img src="cardtemplate.jpg" alt="Reference CardTemplate" class="reference-image" id="referenceImage">
                </div>
                <div class="canvas-wrapper">
                    <h3>Generated CardTemplate</h3>
                    <canvas id="testCanvas" width="500" height="750"></canvas>
                    <br>
                    <button onclick="testCardTemplate()">Generate Test Card</button>
                    <button onclick="downloadTestCard()">Download Test Card</button>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>System Status</h2>
            <div id="systemStatus"></div>
            <button onclick="checkSystemStatus()">Check System Status</button>
        </div>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <button onclick="testFrameOnly()">Test Frame Only</button>
            <button onclick="testWithSampleImage()">Test with Sample Image</button>
            <button onclick="clearCanvas()">Clear Canvas</button>
        </div>
        
        <div class="test-section">
            <h2>Debug Log</h2>
            <button onclick="clearLog()">Clear Log</button>
            <div id="debugLog" class="log"></div>
        </div>
    </div>

    <!-- Load CardTemplate System -->
    <script src="frontend/public/js/cardtemplate-system.js"></script>
    <script src="frontend/public/js/cardtemplate-3d-effects.js"></script>
    <script src="frontend/public/js/cardtemplate-branding.js"></script>

    <script>
        let testCanvas, testCtx, cardTemplateSystem;
        
        // Initialize test environment
        window.addEventListener('load', () => {
            testCanvas = document.getElementById('testCanvas');
            testCtx = testCanvas.getContext('2d');
            
            debugLog('üöÄ CardTemplate Test Environment Initialized');
            checkSystemStatus();
        });

        // Debug logging
        function debugLog(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('debugLog').textContent = '';
        }

        // Override console.log to capture in debug log
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            debugLog(args.join(' '));
        };

        // System status check
        function checkSystemStatus() {
            debugLog('üîç Checking CardTemplate system status...');
            const statusDiv = document.getElementById('systemStatus');
            
            const checks = {
                'SnapMagicCardTemplateSystem': !!window.SnapMagicCardTemplateSystem,
                'Canvas support': !!testCanvas && !!testCtx,
                'WebGL support': !!testCanvas.getContext('webgl'),
                'Reference image loaded': !!document.getElementById('referenceImage').complete
            };
            
            let html = '';
            let allGood = true;
            
            for (const [check, result] of Object.entries(checks)) {
                const statusClass = result ? 'success' : 'error';
                const icon = result ? '‚úÖ' : '‚ùå';
                html += `<div class="status ${statusClass}">${icon} ${check}: ${result}</div>`;
                debugLog(`${icon} ${check}: ${result}`);
                if (!result) allGood = false;
            }
            
            statusDiv.innerHTML = html;
            
            if (allGood) {
                debugLog('‚úÖ All systems ready for CardTemplate testing');
            } else {
                debugLog('‚ùå Some systems not ready - check errors above');
            }
        }

        // Test CardTemplate generation
        async function testCardTemplate() {
            debugLog('üé® Testing CardTemplate generation...');
            
            if (!window.SnapMagicCardTemplateSystem) {
                debugLog('‚ùå CardTemplate system not available');
                return;
            }
            
            try {
                // Create a simple test image (small colored square)
                const testImageCanvas = document.createElement('canvas');
                testImageCanvas.width = 320;
                testImageCanvas.height = 560;
                const testCtx = testImageCanvas.getContext('2d');
                
                // Create a gradient test image
                const gradient = testCtx.createLinearGradient(0, 0, 320, 560);
                gradient.addColorStop(0, '#4facfe');
                gradient.addColorStop(0.5, '#00f2fe');
                gradient.addColorStop(1, '#4facfe');
                testCtx.fillStyle = gradient;
                testCtx.fillRect(0, 0, 320, 560);
                
                // Add test text
                testCtx.fillStyle = 'white';
                testCtx.font = 'bold 24px Arial';
                testCtx.textAlign = 'center';
                testCtx.fillText('TEST IMAGE', 160, 280);
                testCtx.font = '16px Arial';
                testCtx.fillText('CardTemplate Test', 160, 320);
                
                const testImageBase64 = testImageCanvas.toDataURL().split(',')[1];
                
                // Create CardTemplate instance
                cardTemplateSystem = new window.SnapMagicCardTemplateSystem();
                debugLog('‚úÖ CardTemplate instance created');
                
                const startTime = Date.now();
                const result = await cardTemplateSystem.createCardTemplate(testImageBase64, 'Test CardTemplate');
                const endTime = Date.now();
                
                debugLog(`‚úÖ CardTemplate created successfully in ${endTime - startTime}ms`);
                
                // Display the result
                const img = new Image();
                img.onload = function() {
                    testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);
                    testCtx.drawImage(img, 0, 0);
                    debugLog('‚úÖ CardTemplate displayed on test canvas');
                };
                img.src = `data:image/png;base64,${result}`;
                
            } catch (error) {
                debugLog('‚ùå CardTemplate generation failed: ' + error.message);
                debugLog('‚ùå Error stack: ' + error.stack);
            }
        }

        // Test frame only (no image)
        async function testFrameOnly() {
            debugLog('üñºÔ∏è Testing frame only...');
            
            if (!window.SnapMagicCardTemplateSystem) {
                debugLog('‚ùå CardTemplate system not available');
                return;
            }
            
            try {
                // Create transparent test image
                const testImageCanvas = document.createElement('canvas');
                testImageCanvas.width = 320;
                testImageCanvas.height = 560;
                const testCtx = testImageCanvas.getContext('2d');
                
                // Make it transparent
                testCtx.clearRect(0, 0, 320, 560);
                
                const testImageBase64 = testImageCanvas.toDataURL().split(',')[1];
                
                cardTemplateSystem = new window.SnapMagicCardTemplateSystem();
                const result = await cardTemplateSystem.createCardTemplate(testImageBase64, 'Frame Test');
                
                const img = new Image();
                img.onload = function() {
                    testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);
                    testCtx.drawImage(img, 0, 0);
                    debugLog('‚úÖ Frame-only test displayed');
                };
                img.src = `data:image/png;base64,${result}`;
                
            } catch (error) {
                debugLog('‚ùå Frame test failed: ' + error.message);
            }
        }

        // Test with sample image
        async function testWithSampleImage() {
            debugLog('üñºÔ∏è Testing with sample image...');
            
            // Create a more realistic test image
            const testImageCanvas = document.createElement('canvas');
            testImageCanvas.width = 320;
            testImageCanvas.height = 560;
            const testCtx = testImageCanvas.getContext('2d');
            
            // Create a realistic card-like image
            const gradient = testCtx.createRadialGradient(160, 280, 0, 160, 280, 280);
            gradient.addColorStop(0, '#ff6b6b');
            gradient.addColorStop(0.5, '#4ecdc4');
            gradient.addColorStop(1, '#45b7d1');
            testCtx.fillStyle = gradient;
            testCtx.fillRect(0, 0, 320, 560);
            
            // Add some geometric shapes
            testCtx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            testCtx.beginPath();
            testCtx.arc(160, 200, 80, 0, Math.PI * 2);
            testCtx.fill();
            
            testCtx.fillRect(80, 350, 160, 100);
            
            // Add text
            testCtx.fillStyle = 'white';
            testCtx.font = 'bold 20px Arial';
            testCtx.textAlign = 'center';
            testCtx.fillText('SAMPLE CARD', 160, 480);
            
            const testImageBase64 = testImageCanvas.toDataURL().split(',')[1];
            
            try {
                cardTemplateSystem = new window.SnapMagicCardTemplateSystem();
                const result = await cardTemplateSystem.createCardTemplate(testImageBase64, 'Sample Card Test');
                
                const img = new Image();
                img.onload = function() {
                    testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);
                    testCtx.drawImage(img, 0, 0);
                    debugLog('‚úÖ Sample image test displayed');
                };
                img.src = `data:image/png;base64,${result}`;
                
            } catch (error) {
                debugLog('‚ùå Sample image test failed: ' + error.message);
            }
        }

        // Clear canvas
        function clearCanvas() {
            testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);
            testCtx.fillStyle = '#000';
            testCtx.fillRect(0, 0, testCanvas.width, testCanvas.height);
            debugLog('üßπ Canvas cleared');
        }

        // Download test card
        function downloadTestCard() {
            const link = document.createElement('a');
            link.download = 'cardtemplate-test.png';
            link.href = testCanvas.toDataURL();
            link.click();
            debugLog('üíæ Test card downloaded');
        }
    </script>
</body>
</html>
